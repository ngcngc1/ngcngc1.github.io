name: CI  

on:  
  push:  
    branches:  
      - master  
      - main  
  pull_request:  
    branches:  
      - master  
      - main  

jobs:  
  build:  
    runs-on: ubuntu-latest  

    steps:  
      - name: Checkout code  
        uses: actions/checkout@v3  

      - name: Setup Ruby  
        uses: ruby/setup-ruby@v1  
        with:  
          ruby-version: '3.0.2'  

      - name: Enable bundler cache  
        uses: actions/cache@v3  
        with:  
          path: vendor/bundle  
          key: ${{ runner.os }}-gems-${{ hashFiles('**/Gemfile.lock') }}  
          restore-keys: |  
            ${{ runner.os }}-gems-  

      - name: Install deps  
        run: |  
          gem install bundler  
          bundle config path vendor/bundle  
          bundle install --jobs 4 --retry 3  
          npm install -g mermaid.cli  

      - name: Upload Artifact  # 更改为v2版本的上传操作  
        uses: actions/upload-artifact@v2  
        with:  
          name: my-artifact  
          path: ./path/to/artifact  # 替换为您实际的文件路径  

      - name: Deploy website  
        run: |  
          yes | bash bin/deploy --verbose $NO_PUSH --src $SRC_BRANCH --deploy $DEPLOY_BRANCH  
